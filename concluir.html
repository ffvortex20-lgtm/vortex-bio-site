<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Concluir</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial;
  text-align:center;
}
.container{
  max-width:450px;
  margin:auto;
  padding:40px 20px;
}
.progress{
  height:10px;
  background:#222;
  border-radius:5px;
  overflow:hidden;
  margin:20px 0;
}
#bar{
  width:0%;
  height:100%;
  background:lime;
  transition:.4s;
}
button,a{
  display:block;
  width:100%;
  max-width:400px;
  margin:12px auto;
  padding:14px;
  border-radius:8px;
  border:none;
  font-weight:bold;
}
.visit{background:#0d6efd;color:#fff}
.confirm{background:#444;color:#fff;opacity:.6}
.confirm.active{background:green;opacity:1}
#download{display:none;background:green;color:#fff}
</style>
</head>

<body>

<div class="container">
<h2 id="titulo"></h2>

<div class="progress">
  <div id="bar"></div>
</div>

<button class="visit" onclick="abrir()">ðŸ”— Visitar pÃ¡gina</button>
<button id="confirm" class="confirm" disabled onclick="liberar()">âœ… JÃ¡ visitei</button>

<a id="download" target="_blank">â¬‡ Baixar agora</a>
</div>

<script>
const p = new URLSearchParams(location.search);
const titulo = p.get("titulo");
const canal = p.get("canalLink");
const download = p.get("downloadLink");

document.getElementById("titulo").innerText = titulo;

let tempo = 0;

function abrir(){
  window.open(canal,"_blank");
  tempo = Date.now();
}

document.addEventListener("visibilitychange",()=>{
  if(document.visibilityState==="visible" && tempo){
    let t = (Date.now()-tempo)/1000;
    if(t >= 8){
      document.getElementById("confirm").disabled=false;
      document.getElementById("confirm").classList.add("active");
      document.getElementById("bar").style.width="100%";
    }
  }
});

function liberar(){
  const btn = document.getElementById("download");
  btn.href = download;
  btn.style.display="block";
}
</script>

</body>
</html>
